/**
 * @author Doraemon
 * @name 常规签到爬取
 * @origin 红灯区
 * @version 1.0.9
 * @description 扫描某文档当天签到token
 * @rule ^(qdscan)$
 * @admin true
 * @public false
 * @priority 1000
 * @disable false
  说明：
    1、在红灯区同级目录创建一个文件夹，名字随意 如：自用插件

       常规签到扫描.js 放到自用插件中

    2、设置一些的变量

      （默认1天1豆）自定义签到监控别名
        set Doraemon regular_sign_scraping_alias xxx  

      （默认10s）自定义撤回时间
        set Doraemon regular_sign_scraping_wait xxx   
          
     （默认0）份数，如填50，则只筛选50份以上的数据 
        set Doraemon regular_sign_scraping_limit xxx 

      必填 文档地址（自己找文档地址）
        set Doraemon regular_sign_scraping_url xxx    

      必填 如果你要取 2天 3天的数据，则填 2,3
        set Doraemon regular_sign_scraping_regex xxx

      支持自定义时间：如4月25 （冗余，默认留空）
        set Doraemon regular_sign_scraping_custom_date xxx

        如果要删除命令： del Doraemon regular_sign_scraping_custom_date

  ----------------------

  注意：
   1、简单测试可用
   2、无界超授可用
   3、自用插件
  ----------------------

  功能：
    1、每日定时扫描某常规签到token文档，自动匹配相关数据，省去人工的操作 （已实现）
    2、自动内联执行命令，触发 红灯区 店铺签到监控.js，执行相关任务 （已实现）
    3、通过自定义正则匹配 xxx份数据（份数太少，签了没意义 ）  （已实现）
    4、通过自定义设置匹配 具体的天数，比如我只要签2天的线报 （已实现）
  ----------------------

  更新日志：
      v1.0.0 插件上线
      v1.0.1 支持份数筛选
      2023.4.28 v1.0.2 支持处理未知深度的链接 比如 3天10豆下有多个链接
      2023.4.29 v1.0.3 支持一个线报中，多份数的过滤 如 3天10豆 7天100豆 100+50份，就按照总份数
      2023.5.5 v1.0.4 线报天数（regex） 支持一位或者多位
      2023.5.5 v1.0.5 内联执行 店铺签到清理 命令，具体功能详见 红灯区 - 店铺签到监控
      2023.5.6 v1.0.6 修改加密导致的bug
      2023.5.13 v1.0.7 修复cron 内联执行 店铺签到清理 造成的死循环问题， 改成静默执行
      2023.5.14 v1.0.8 所有参数改为读取内置数据库
      2023.5.15 v1.0.9 本地最新版本
*/

 //插件入口
module.exports = async s => {
  /** Code Encryption Block[419fd178b7a37c9eae7b7426c4a04203e718ff222f9d0ceb298295aedf4e5c07fd2ee38f9e0975c19ad3328f204b4db5d43b681c2cf4271b7c40617e0d98e1de283a31bbad3a5dc7dd9aca0094d6a7fb9bd1c3445e7cb1b757d045820cbdec0f6d824cdb6a916cee7d81996f34be4bf7e18e428c268327ef7fde8f4d4a3a3147c59a47d73845e937105d3ab7be0c7ec0c7136d53805b682421502dda8c403bb669692bf5f298271bcf89f5bfef3d6e4b7f6eb49b9b4eac5e8a99ed968143e0cbac13ee38c725a5b2953e48d8d0223a7213b9c835719068b1ef349deeb36b553cacddea8aece28da3d0e2268f7ec557e6b73837eaa3374a5d1b3a2d9fc62bd7dd1dc6306f6b2376fc68ff04cdf6fde8067fc576be7273d3797adaf5fab48c177342be6898e6d4f84a25a1dac1e964cc6040f8a81c1064c42bdde5d147ff34fe2adf7c23350aec98f5e8237a7f42770187fa5707848c2409deeca6da7f276cf35a7c5eb8901510dd49b762efdc3c94c3ec63ebf450f8040cc81ff9edc51ceb944a92aef722850ddd806a1ea05d0817de63cdd9cb3f3f80edfb4ae5d93de65266b61a1193c9c9d7c40464dfba2749e0bc3828a3b9d8018a77da488b905fc8e9513e7b7fcd82b433730e63db2e65d1c2bf4ab06cab739158b9305fb16a3c1028a8c7574f8c900b0a58457e5b6c3ed37a71faa06578cdab350f582597424b30ef659262153b3887a26d53d6e3c93ca0740b479b0f7d2359c1cff54d4edb425f8c2d3b70a4adea3be15189412368d4686e9f1a8c50bcdb0d6aa92f47bd9ea4019e4e1d0d21a511594ddb75980911c52b4f2ab884610feeb4181afa119cb955b6397c23b5e78afcfce798a5c11d999509637779e1c907d8722f913a1cf323b32ad89af83a2dd30ee4f8beb7c718538ba034e203c518b3ace6f7b4b53e91a196f94ec06132bb921b62e46fb39b8e2abe184c298d07db3c24e25df2d651466e12db4e79e2c3ec404bf957fde2b943282cffa1c64fcac628bbefc25c9f7502ae1afd17560a7537d427146a07ff1a48c80f39616f55c21bce2675bda4ca1d1c352c7836602200d8df9d2ea25b72a34d4572ed190f646be40758c5e9834da2bacec8b164081f6edffa13871d9692b7074bd0c2d117788454dc6d7eebd9f5416459e271c2c2ccaff1cd1d90b5eba06c5ca72584bc311a6310c401fa610bfee897dcda27a57a625dce0674ce43277263833a06f1bfac8651ee368643803a7afdb9e42ce6d48bb099b42b48fc2bce359f13ab545db0c18e74702bde5e697a5ef6353cc598bcfe61e2d576122d5d2a45836c8933c81af4ab589b463d2aa122f3e4b0617449f3b3d60b03437934c1b87d05acdbe7d041b80460daace4c11a92bd47853d9796cb32922ce4fba1be30001446321f76a9b107cd55550990e667222832db12c35f6af24f926846f750443f58cf84827c42d65094eb730bf189367dce1ad2205c62a1d5619fe9cd391a619a7eb4b03dde64f292e7d219e259bb4e2ff041a240153c9810647858977d14e015700976d30d2af42a537a0b86dad622e62eb9fb883dd93a2c6025008b18c3a680afdbf241940d95ca936c8c3e017f63417baea3fa1918be6bec9fd58546b82710047973ed204ab4aa3f0129e650ff3c585850493e26ef56ca5d8358cb393b0b17ec174f9a1a18c42471496f2df4ca5372b860d3aebf9c5622cfaa08dbe686857999613ba281814c02bf5fdb6bb909ae8c360e80abb81edbeb1cfeb329fc2d65cfec7b010029ef88e3d9d4dc7e8f15c9be90c9a5030a87e9ca991bfd20dd57035a6dcfd796426cab538ef8bafd3ce8db08b18ccdc0894761a83f5dc0cb31d6eb54e790edcea7e68bd941429ee7a8787eb001a59417025156490e0b7d99219e32625aea1fa50a58efe0972148a00df175374d111b681c0b6ca65a829a1d194686c2ac2540b18484c345e6fcc3ca2f84b5dcf018502be20f9660fdf255606bfda9916897e96d7bd2de5b021ba3e381798b3a3a301a97d0c7aa99b96d95fdb8e4e81db0d8831c91b9a046d305db9c8ed96bdbd2d629d457a9142beeefced5a5448dace5dd840647e88e2fc13d2bb875e082328eb0217aabe276c947ca5b694a89b66eeefff97c9355e48202bffc656e1acf1bc4077d96f870e5656f5e681d5ebe5fc04368aea1e8e686d1f9b98b91863cb4f57f633ea3f931e9acd626312d41563072d417f5f443e58fadacd987c77952667cf972a734700d2dcfe6a790c39cf5369ff12098a2fbea013e1843492ff6595d0307625a5248912e14a8844906b16779b8169b09796b304ae894950aa7d79c0bb2550e230343822886d27fe29c6dc81f386e8409dfbff4cdd5733c7a15f83dfd32d84fa983bcf9b9f810cb4cadae66894d2e2aa6ecb4d38679e6590ccc382a38500c3cc2bf29a8866d2e8f49230994eb2672837548fc9508eaa9cbd4a3829d71c7b325436460686d6a49977660e9a5c3d74aabf6841110401249f9d0e6dbae92f527281d0a309bbc881974d5f1bee28ba874aad365026c936211749098f59f099cba72887a266c827ad7c6d50572e2e069ab0332cff060668537f912e944654b0dfe872c6a25aeb8915eb28407e8acbbe8e907a8a8e4ceb700de3f38a7425218c2d70d4319543a42f483eb11cf37434219a2529b7869d7a55eb5bbbd837296c2a5dab8a374b6822aff50fdf746891664e9eb31b0d670553e164e7b6a7ba442383096d978fd1ef67a3b28e4e5b8483e8300cd0b27b14cd8d6df35f2200895e0dd2c48c62474dfde1515edb9bbae5935c81fb24e46b4155adc2c97a310308be3e35257effa4b878579d7d3445103d88d700fbbb8d90e4b4f516055a39aa6e7be5e7c02c106bec3035671889dedd5798ed2a5e7b7f57ce42fc69d9e8d48399ca28eafc89ce8ae6d7c39376bc25fbf5d3d66191baef41736150be1b65af83f0e7147e53ef98cbae83b977e74cb9e5c6a4c380b35d034d9a5036445bc12d8acaf265dd0822212079879f52b127a162203df3208ff9db2db2ee401c4fce65ed2c34fcb40c469bce4d47f98d1fe293bc6b0e45dd8baa276cb9596b736ae3aa0b22302efa327f96cc790917d9be2372da611f23021eaeae2ada7db0f8ea0d46ea3bb947e91a0ac6f54e3f40dc34bafc692d71714792f42636616f774fbdecdabcf07706bfc13def194eb9e4df36e5249d2666ea502a38e6e8cf1eb57ad732e87af0dce95bfca788e12c863734dd18ec2513bbfe39fe0f53c12244340a7e90c20b149eeba6a69c91dfcdc4d118c8556c435da4b2cd743a89710f0ba2338b9ab88090c6cf187d1371f50c5acb1f7214be77c0d8bc25f4f6e3f2205ad7d3d923d5e185a05b718bcf400e9d0daec583b5df784c197bc8d6805bf72f29ea8e0d28f28a5b3e734f664079c1599a3957772d356e4c5d80c67633fb72ee495c4ebe0858bd3884da7e027740693768ef7eebff263eb2f8ce3f5bbcac838d479926cb118b0836dbb91b9bdd047bc35ffe7b796a16e34956ed05dbc4d10bf6747317dbd75b9d6b3bc05f83b3af21095c2befaffc26c548fe24500aabba69d8d784c966550e5ce000a5d21ed4670dc351930767ab144f486002c9514a0bc73117f3ddf8001dafc180ab43910f790aae91b17e196143a6472155410a6a6b781c1f92b03d035cf3d2c76e3a5103954fb4f259133736a2f4b7b4b4b9b1c19e5f25fe8ec1c959e77ad78f6c84d78557bee046a0a61037c567c0783549291de2b8ef9ae09f0bf792612a01f7b34933a1d61f1e133e234373cf9a8e952bd96e86d371bd545cb488b764a50507bcf01ef6a12d667fb513d8948c9c540d0c87391351075fd7dca674e45b364505ecf30336b12643a9431bbb3a03f15ffa258d97ac2b5fb152cde007677e53f052d26c191baa7c023d361594c392646a2a0391c39bf86c216be4fa56390e0ea864e402dfab619c275bc374bf107076392468f4aac276e3d8e89aad3596441943536b12c80889d7746f1a03d558ff4fa1b81cba3074646dab00b5944d6dc12136b5d45bde2e21e54716a4b63799b2b35f2f6ff2ed68afb9ee56c30bfc494d2b925e4c0150a9a9338396e7b6b] */

  /**
   * 递归查询
   * @param {*} nextP nextP
   * @param {*} result result
   * @returns 
   */
  function extractLinks(nextP, result) {
    if (nextP.text().match(/https:\/\/[A-Za-z0-9\-\._~:\/\?#\[\]@!$&'\*\+,%;\=]*/)) {
      result.push(nextP.text().trim());
      return extractLinks(nextP.next('p'), result);
    }
    return result;
  }
};
 