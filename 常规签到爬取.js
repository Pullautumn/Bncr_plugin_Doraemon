/**
 * @author Doraemon
 * @name 常规签到爬取
 * @origin 红灯区
 * @version 1.0.8
 * @description 扫描某文档当天签到token
 * @rule ^(qdscan)$
 * @admin true
 * @public false
 * @priority 1000
 * @disable false
 * @cron 0 50 23 * * * 
  说明：
    1、在红灯区同级目录创建一个文件夹，名字随意 如：自用插件

       常规签到扫描.js 放到自用插件中

    2、设置一些的变量

      （默认1天1豆）自定义签到监控别名
        set Doraemon regular_sign_scraping_alias xxx  

      （默认10s）自定义撤回时间
        set Doraemon regular_sign_scraping_wait xxx   
          
     （默认0）份数，如填50，则只筛选50份以上的数据 
        set Doraemon regular_sign_scraping_limit xxx 

      必填 文档地址（自己找文档地址）
        set Doraemon regular_sign_scraping_url xxx    

      必填 如果你要取 2天 3天的数据，则填 2,3
        set Doraemon regular_sign_scraping_regex xxx  

      支持自定义时间：如4月25 （冗余，默认留空）
        set Doraemon regular_sign_scraping_custom_date xxx

        如果要删除命令： del Doraemon regular_sign_scraping_custom_date

  ----------------------

  注意：
   1、简单测试可用
   2、无界超授可用
   3、自用插件
  ----------------------

  功能：
    1、每日定时扫描某常规签到token文档，自动匹配相关数据，省去人工的操作 （已实现）
    2、自动内联执行命令，触发 红灯区 店铺签到监控.js，执行相关任务 （已实现）
    3、通过自定义正则匹配 xxx份数据（份数太少，签了没意义 ）  （已实现）
    4、通过自定义设置匹配 具体的天数，比如我只要签2天的线报 （已实现）
  ----------------------

  更新日志：
      v1.0.0 插件上线
      v1.0.1 支持份数筛选
      2023.4.28 v1.0.2 支持处理未知深度的链接 比如 3天10豆下有多个链接
      2023.4.29 v1.0.3 支持一个线报中，多份数的过滤 如 3天10豆 7天100豆 100+50份，就按照总份数
      2023.5.5 v1.0.4 线报天数（regex） 支持一位或者多位
      2023.5.5 v1.0.5 内联执行 店铺签到清理 命令，具体功能详见 红灯区 - 店铺签到监控
      2023.5.6 v1.0.6 修改加密导致的bug
      2023.5.13 v1.0.7 修复cron 内联执行 店铺签到清理 造成的死循环问题， 改成静默执行
      2023.5.14 v1.0.8 所有参数改为读取内置数据库
*/

 //插件入口
module.exports = async s => {
  /** Code Encryption Block[419fd178b7a37c9eae7b7426c4a04203e718ff222f9d0ceb298295aedf4e5c07fd2ee38f9e0975c19ad3328f204b4db5d43b681c2cf4271b7c40617e0d98e1de283a31bbad3a5dc7dd9aca0094d6a7fb9bd1c3445e7cb1b757d045820cbdec0f6d824cdb6a916cee7d81996f34be4bf7e18e428c268327ef7fde8f4d4a3a3147c59a47d73845e937105d3ab7be0c7ec0c7136d53805b682421502dda8c403bb669692bf5f298271bcf89f5bfef3d6e4b7f6eb49b9b4eac5e8a99ed968143e0cbac13ee38c725a5b2953e48d8d0223a7213b9c835719068b1ef349deeb36b553cacddea8aece28da3d0e2268f7ec557e6b73837eaa3374a5d1b3a2d9fc62bd7dd1dc6306f6b2376fc68ff04cdf6fde8067fc576be7273d3797adaf5fab48c177342be6898e6d4f84a25a1dac1e964cc6040f8a81c1064c42bdde5d147ff34fe2adf7c23350aec98f5e8237a7f42770187fa5707848c2409deeca6da7f276cf35a7c5eb8901510dd49b762efdc3c94c3ec63ebf450f8040cc81ff9edc51ceb944a92aef722850ddd806a1ea05d0817de63cdd9cb3f3f80edfb4ae5d93de65266b61a1193c9c9d7c40464dfba2749e0bc3828a3b9d8018a77da488b905fc8e9513e7b7fcd82b433730e63db2e65d1c2bf4ab06cab739158b9305fb16a3c1028a8c7574f8c900b0a58457e5b6c3ed37a71faa06578cdab350f582597424b30ef659262153b3887a26d53d6e3c93ca0740b479b0f7d2359c1cff54d4edb425f8c2d3b70a4adea3be15189412368d4686e9f1a8c50bcdb0d6aa92f47bd9ea4019e4e1d0d21a511594ddb75980911c52b4f2ab884610feeb4181afa119cb955b6397c23b5e78afcfce798a5c11d999509637779e1c907d8722f913a1cf323b32ad89af83a2dd30ee4f8beb7c718538ba034e203c518b3ace6f7b4b53e91a196f94ec06132bb921b62e46fb39b8e2abe184c298d07db3c24e25df2d651466e12db4e79e2c3ec404bf957fde2b943282cffa1c64fcac628bbefc25c9f7502ae1afd17560a7537d427146a07ff1a48c80f39616f55c21bce2675bda4ca1d1c352c7836602200d8df9d2ea25b72a34d4572ed190f646be40758c5e9834da2bacec8b164081f6edffa13871d9692b7074bd0c2d117788454dc6d7eebd9f5416459e271c2c2ccaff1cd1d90b5eba06c5ca72584bc311a6310c401fa610bfee897dcda27a57a625dce0674ce43277263833a06f1bfac8651ee368643803a7afdb9e42ce6d48bb003fbd4b84267263612037ebf5e03af63b7bccccc8ecd26c238cd6b6615a171e39578bfd6b6d6323191b8eb4014ec71409ef94b79c2a85bcdf40ac11327f1354ef9ee4d059035755ec180b6c005830b0557d4342e9c2c32a995832948256dcae7bab2db1523e15194081d7fd1c0bf5d56a9f6d2ffd36ff9ed7605955f813fa7de3c0f2bf12fc12737169173fd0126b3e8c4f4a5be15de404d744461b54ad7ee72c3426f89531c871367dbcdb3154938ddbc0e0c5d34f8713e451b0d76362bb766c45b9dbff4bb6219ee799d818fbb9eebf8fe228209e290c57e2bfbe9d253ff3d74a509991d92bcc0969ab561d798f907fd3e1a823af2b5cdddc1d5ed2b1abbabc533db88fdcbb5b1a60accc1ca58666566c3217437b52239649e4a4e32a54ab9d6d91ad7f73d7a55641c9096f98b5b5796c7d4b0298218d7c70b06c6e72d6a8f3521d7b9a4850d3488110f681a5ce51eaa65b01b598eb74442dee7bab64632c76c64dbae141e3c1cc4dc840404f2905617b4985259c9da818fb5469b1669e5eb8d637c2cb61ef8bfaaf16816dc39e0ede175cb916c43570a7d85e38749464a7ccd8de37326bc6c57f9d38ea7c969ff693458bc2ff336973cb364b40e2aa5a58d7ddde5c6cf64912440a71e316d8310eb1d0218e0e5b17a1f0544f0114ff897dc132b3e70349d1ba500b9a23f0ac7c57e91124757d5c0ecb2433659c3e1bf6b0cfd18952b39da8dd2a094e99c1fea6d34d8fba2d44aea8e69f6ebcaea21ab30dcd7f1f6b786e000d7436ad6d76383ec39446a5ff9b974f140d355a3b41b55c37f3f506f74e87579ef90f469474b651d1d72ff68408018ac6c06f247e6c0c398e456bbef94ea2da2066c251d8bfd39e04bd29b27ebdde1534bfcd5d5cf04fadbb294d733f3b51531d57aa18d8ef1d20cf0099e340e8d7eb5335531b298b9d8e2cf2813f0f412af3e7b0d68cad0358b267aa08db1e3e394163a766d3cee695f8699c3ab8f0ec1152de5fdb4724f3c968bb399da9e15db0aa2e6c399105cf6137db8f6b8abc430aaa89619399943e729ad0719859b193f7950dfdca7803b7d464442d8b5f6d9061332ac688194f7d74668006845354c5d15c62332c67f39678483a17eb0b4582be4a654de35c4a02767a7f1260c90224cba328c7fa66cee6b3765686dd26741478959df892afe5b9df94affce6fe3a90f49ab0be8818f51a3f83b496c8e3cebb2725a730d2979548c0a993a261354665559693adc69dca53918eb4a19593137476b8d7ed7a0f75037089c701369b94f4a8c7802b8c62acce133a920508770d3642bc519ba96d56c37fedd7f3cd06a792d9778ede9ae2080a689aac159222ab1a8dc6a27117b2de282f0decf6945bb87bdf34ceb064a40a7743268879a28147c1595782635d1635faa8a674fa25da1a26b27c6611bfc4706bceb74101290346993e3a247dea1f6fe6d6931d16be3f0146877458acb2d257d5e1c2656fd218031667663c9c62bf61e132ab2fd66a93175b8ff8ea9a7f6583e918d5fa1d91b8899e487a217ccf6c7bb3873fbbaaf4ab54067ebc2d569668cab94f9209eb2dfed536d4d79a8a1e1ce734fbfa27549596ebc7376ebaf4cd9ca1a58c47db7fd22ce231e742fa25dd4453250252d924c7ab0837ca90ee6e536e5e27455fa4a51fdae854cc96b651983eda3e4a25d5752dba2bf17771e6a16751c2c9181d9b93c826f91892840f854bfa37002b0204de904026319eec620544c85d54a17ae148da186dca406ed80c38f5176a20f22360e79a0ff22458093c58795f8e296034487dc12026de06901b5fed9c508a0ac83b1e0d5a852c18400a17ba34b942c456e06dc1a8f6f7e65198da9e1903fccb01207e389ad3c37e80360d1101c069bfb7c0124265f96d84a91672f016ca536202a9fa142159af455d64fd3e2690e16cc15bf92ec44db549fe24033b21c6458e30c5061b2bd75b9d8a353665c17af6b8b4fd633b0a8efa685b3de68399aaad09b93ac7219f9f14a5255c1a0f55b41fc3026ff7fc88436026dc23ca703adb4bbbbb0f4ab4d1d494e4b49a9e6def3677ad4b34ad63ef6df5519ccf751df9668b9a10d8573e4aad378cd0ec61059eb852d910f91a6df74135ef95e1dc71a0c5e73f6fbc77a2d7ec2b96ed92c73826aa54d604408f97cbc064261e7e153a82af463b1ccc14ed7493cbd8a6ed94de7d544b621a5223d721ad9cfd1cd9a06bf7a7bb14062996ccfc161afbc92dd3d048bd6962d8c42a2473a2277668b21b197c74c723d5687f38c5de70744b994d072e6e14e713646b01f009d3a69511d8c67a5203f01d6ef05d0222b7d17935d5f88752ee3b81a21f41f9fc3154ed8dc1907fb5f78be659198149e22479bb6d51a8cad452d709a36f8fd4913e67d1937739c849b91817eef52b465409148ab2117487e18805a963fd6fce3343a3a2d2ac56e31bd9620f39f62a6e2d0aea7a4b440f2876d429a374b9a90f5fd5b8812b7d6c2f21b6e3493ef968f05fcc80a91475b28524e7a327dfe3c7a3f8616a3a28ff20bb2e38d763bc43a14e2bd86c00b457df9e4a6bfc4a69496226013785f40dff4c61a776665786b12452ed1857ca32519d58c5a0e13d63652d9d7ad609274aa58781556294a3b35e7c0c394d0523ad06268b4ebdb64c6625a8ec2261770fb626f4b72131c330f] */

  /**
   * 递归查询
   * @param {*} nextP nextP
   * @param {*} result result
   * @returns 
   */
  function extractLinks(nextP, result) {
    if (nextP.text().match(/https:\/\/[A-Za-z0-9\-\._~:\/\?#\[\]@!$&'\*\+,%;\=]*/)) {
      result.push(nextP.text().trim());
      return extractLinks(nextP.next('p'), result);
    }
    return result;
  }
};
 